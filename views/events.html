{% extends "layout.html" %}

{% block pageclass %}event_calendar{% endblock %}

{% block leftcontent %}

<ol class="breadcrumb">
  <li><a href="/">Echo</a></li>
  <li><a href="/events">Events</a></li>
</ol>

<div id='calendar'></div>

{% endblock %}

{% block script %}
<script src="/bower_components/moment/min/moment.min.js"></script>
<script src="/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
<style>@import "/bower_components/fullcalendar/dist/fullcalendar.min.css";</style>

<script>
$(document).ready(function() {

	// Get the start date from the URL
	var start = moment(location.pathname, "YYYY/MMM");

	function urlise(moment) {
		return "/events/" + moment.format("YYYY/MMM").toLowerCase();
	}

	$('#calendar').fullCalendar({
		events: '/api/json',
		defaultDate: start,
		loading: function(isLoading, view) {
			if (!isLoading) return;
			history.pushState(view.intervalStart.toISOString(),
				null,
				urlise(view.intervalStart));
		}
	})

	window.addEventListener('popstate', function(e) {
		$('#calendar').fullCalendar('gotoDate', history.state);
	});

});
</script>

{% endblock %}
