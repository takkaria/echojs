{% extends "layout.html" %}

{% block pageclass %}event_calendar{% endblock %}

{% block leftcontent %}

<ol class="breadcrumb">
  <li><a href="/">Echo</a></li>
  <li><a href="/events">Events</a></li>
</ol>

<div id='calendar'></div>

{% endblock %}

{% block script %}
<script src="/bower_components/moment/min/moment.min.js"></script>
<script src="/bower_components/fullcalendar/dist/fullcalendar.min.js"></script>
<style>@import "/bower_components/fullcalendar/dist/fullcalendar.min.css";</style>

<script>
$(document).ready(function() {

	// If the URL is just '/events' then we start at today's date
	var start = moment();
	if (location.pathname != "/events")
		start = moment(location.pathname, "YYYY/MMM");

	$('#calendar').fullCalendar({
		events: '/api/json',
		defaultDate: start,
		fixedWeekCount: false,
		firstDay: 1,	// Start on Monday
		timeFormat: 'h(:mm)a',

		eventBackgroundColor: "#eee",
		eventBorderColor: "#ccc",
		eventTextColor: "black",

		loading: function(isLoading, view) {
			if (!isLoading) return;
			history.pushState(view.intervalStart.toISOString(),
				null,
				"/events/" + view.intervalStart.format("YYYY/MMM").toLowerCase());
		},
		eventClick: function(event, jsEvent, view) {
			// XXX use the slug instead when supported
			location.href ="/event/" + event.id;
			return false;
		},
	})

	window.addEventListener('popstate', function(e) {
		$('#calendar').fullCalendar('gotoDate', history.state);
	});

});
</script>

{% endblock %}
