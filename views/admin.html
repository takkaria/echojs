{% extends "layout.html" %}

{% macro statBox(opts) %}
	{% if opts.link %}<a class="stat-link" href="{{ opts.link }}">{% endif %}
	<div class="stat stat-{% if opts.warning %}warning{% else %}primary{% endif %} }}">
		<div class="stat-num">{{ opts.num }}</div>
		<div class="stat-below">{{ opts.below }}</div>
	</div>
	{% if opts.link %}</a>{% endif %}
{% endmacro %}

{% block title %}Administrative dashboard{% endblock %}
{% block pageclass %}admin{% endblock %}

{% block header %}
<ol class="breadcrumb">
	<li><a href="/">Echo</a></li>
	<li><a href="/admin">Admin</a></li>
</ol>
{% endblock %}

{% block content %}
<div class="container">
	<div class="row">
		<div class="fullwidth">

			{{ checkMessages() }}

			<h2>Dashboard</h2>

			<h3>Events</h3>

			<div class="stat-row">
				{{ statBox({
					num: stats.events.imported + stats.events.submitted,
					below: 'to be approved',
					warning: stats.events.imported + stats.events.submitted,
					link: '/admin/events'
				}) }}

				{{ statBox({
					num: stats.events.approved,
					below: 'currently live'
				}) }}

				{{ statBox({
					num: stats.eventsComingUp,
					below: 'in the future',
					warning: !Math.max(0, stats.eventsComingUp - 7)
				}) }}
			</div>

			<h3 class="clear-left">Feeds</h3>

			<div class="stat-row">
				{{ statBox({
					num: stats.feeds.total,
					below: 'in total'
				}) }}

				{{ statBox({
					num: stats.feeds.errors,
					below: 'errors',
					warning: stats.feeds.errors,
					link: '/admin/feeds'
				}) }}
			</div>

		</div>
	</div>
</div>
{% endblock %}
